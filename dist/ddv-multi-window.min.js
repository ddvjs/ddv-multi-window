/*!
  * ddv-multi-window v0.1.10
  * (c) 2018 yuchonghua@163.com
  * @license MIT
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.DdvMultiWindow={})}(this,function(t){"use strict";function n(t,e){if(!t)throw new Error("[ddv-multi-window] "+e)}var s="undefined"!=typeof window;function r(t){return void 0!==t}function d(t,e){return r(t)?t:e}function m(e,i){return Object.keys(i).forEach(function(t){e[t]=d(e[t],i[t])}),e}function o(t){return"function"==typeof t}function e(t){if(this instanceof e)return i.apply(this,arguments);throw new e(t)}function i(t){this.promises=[],this.isReadyCb=void 0,this.ing=!1}e.prototype={isReady:function(){if(!0===this.isReadyd)return Promise.resolve();return new Promise(function(t,e){this.isReadyCb=[t,e]}.bind(this))},emitReady:function(t){if(this.isReadyd=!0,!(this.isReadyCb&&Array.isArray(this.isReadyCb)&&this.isReadyCb[0]))return;t&&this.isReadyCb[1]?this.isReadyCb[1](t):this.isReadyCb[0]&&this.isReadyCb[0]()},waitReady:function(){return new Promise(function(t,e){this.promises.push([t,e]),function(){if(this.ing)return;return this.ing=!0,this.runStartTime=new Date,function t(){return this.isReady&&"function"==typeof this.isReady?this.isReady():new Promise(function(t,e){new Date-this.runStartTime>this.initCheckTimeout?e(new Error("wait Ready Timeout")):setTimeout(t,this.initCheckInterval)}.bind(this)).then(function(){return t.call(this)}.bind(this))}.call(this).then(function(t){for(var e;(e=this.promises.splice(0,1))&&(e=e&&e[0])&&"function"==typeof e[0];)e[0](t);this.ing=!1}.bind(this)).catch(function(t){for(var e;(e=this.promises.splice(0,1))&&(e=e&&e[0])&&"function"==typeof e[1];)e[1](t);this.ing=!1}.bind(this))}.call(this)}.bind(this))},setIsReady:function(t){this.isReady=t},constructor:i,isReadyd:!1,isReadyCb:void 0,initCheckTimeout:3e3,initCheckInterval:100};var a=require("jquery");function l(t,e){!r(e)&&r(t)&&(e=t,t=void 0);var i=a(e);return t?i.closest(t):i}function c(i,n){var s=[];return i.forEach(function(t,e){n(t)&&s.push.apply(s,i.splice(e,1))}),s}var h={name:"horizontal-task",props:{task:{type:Object},process:{type:Object,default:{}},handleTask:{type:Function},taskOptions:{type:Object}},computed:{taskId:function(){return this.task?this.task.id:null},activeId:function(){return this.task?this.task.activeId:null},pids:function(){return this.task?this.task.pids:[]},dragData:function(){return this.$ddvMultiWindow.dragData||{}},taskMenuStyle:function(){var e=this,i={};if(this.taskOptions.menuStyle&&"object"==typeof this.taskOptions.menuStyle){var n=Object.keys(this.taskOptions.menuStyle);n.forEach(function(t){(e.taskOptions.menuStyle[n]||0===e.taskOptions.menuStyle[n])&&(i[t]=e.taskOptions.menuStyle[n])})}return i}},data:function(){return{tabTaskLiLists:{},isLeave:!1,isShowDropdown:!1}},methods:{setInfo:function(t){var e=this,i=l(this.$refs.tabTaskWrap),n=this.pids.length;this.dragData.event=t,this.dragData.interval=[],this.dragData.$dom&&this.dragData.$dom.length?this.dragData.activeWidth=this.dragData.$dom.innerWidth()||this.dragData.activeWidth||0:this.dragData.activeWidth=this.dragData.activeWidth||0,this.dragData.marginLeft=0,this.dragData.$dom.attr("dmwDrag","1");for(var s=0,r=0;r<n;r++){var o=l('[processid="'+e.pids[r]+'"]',e.$refs.tabTask),a=Number(o.css("margin-left").split("px")[0]),d=Number(o.css("margin-right").split("px")[0]),c=o.position(),h=o.is('[dmwDrag="1"]'),u={};e.dragData.marginLeft+=a,h?s=o.innerWidth()+a-d:(u.startX=c.left+a-s,u.endX=c.left+o.innerWidth()+a-d-s,u.pid=e.pids[r],e.dragData.interval.push(u))}this.dragData.marginLeft=Math.round(this.dragData.marginLeft/n),this.dragData.barStartY=i.position().top,this.dragData.barEndY=this.dragData.barStartY+i.outerHeight()},reduction:function(){l(this.$refs.menuArrow).css("margin-left",this.dragData.marginLeft+"px"),l('[active="active"]',this.$refs.tabTask).css("margin-left",this.dragData.marginLeft+"px").removeAttr("active")},handleTabDragStart:function(t,e){var i=this.process[e],n=l(this.$refs.tabTask);this.dragData.$dom=n.closest(t.target),l(this.$refs.tabTask).addClass("transition"),this.setInfo(t),this.dragData.id=e,this.dragData.ing=!0,this.dragData.taskId=this.taskId,this.dragData.rootTaskId=this.taskId,this.dragData.isCross=!1,t.ddvCmsTaskWindowId=e,t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="linkMove",t.dataTransfer.setData("ddvCmsDrag",JSON.stringify({type:"tabTask",data:{windowId:e}})),t.dataTransfer.setData("text/plain",i.href||i.src)},handleTabDragEnd:function(t,e){var i=this;if(!0===this.dragData.ing)return this.dragData.ing=!1,l(this.$refs.tabTask).removeClass("transition"),this.activeEvent=null,this.dragData.id=null,this.reduction(),this.dragData.$dom.removeAttr("dmwDrag").show(),this.dragData.taskId!==this.taskId||t.pageY>=this.dragData.barStartY&&t.pageY<=this.dragData.barEndY-2?void 0:this.$ddvMultiWindow.tryRun(function(){return i.$ddvMultiWindow.openMasterWindow(e).catch(function(t){return"OPEN_WINDOW_FAIL"===t.name?i.$confirm("\u4f60\u662f\u5426\u8981\u5728\u65b0\u7a97\u53e3\u6253\u5f00","\u63d0\u793a",{confirmButtonText:"\u786e\u5b9a",cancelButtonText:"\u53d6\u6d88",type:"warning"}).then(function(){return i.$ddvMultiWindow.openMasterWindow(e)},function(t){}):Promise.reject(t)})})},handleTabWrapDragOver:function(t,e){var i=this;if(!0===this.dragData.ing){t.preventDefault();var n=l(this.$refs.tabTask),s=l(this.$refs.menuArrow);if(this.taskId!==this.dragData.taskId&&(l(this.$refs.tabTask).addClass("transition"),this.setInfo(this.dragData.event),this.dragData.isCross=this.dragData.rootTaskId!==this.taskId),this.dragData.taskId=this.taskId,t.pageY>=this.dragData.barStartY&&t.pageY<=this.dragData.barEndY-2){var r=!1;this.dragData.$dom.hide();for(var o=0;o<this.dragData.interval.length;o++){var a=i.dragData.interval[o];t.pageX>a.startX&&t.pageX<a.endX&&(r=!0,n.closest('[active="active"]').css("margin-left",i.dragData.marginLeft+"px").removeAttr("active"),l('[processid="'+a.pid+'"]',i.$refs.tabTask).css("margin-left",i.dragData.activeWidth+"px").attr("active","active"),s.css("margin-left",i.dragData.marginLeft+"px"),i.dragData.replaceId=a.pid,i.dragData.isLast=!1)}if(!r){n.closest('[active="active"]').length&&n.closest('[active="active"]').css("margin-left",this.dragData.marginLeft+"px").removeAttr("active");var d=this.dragData.interval[this.dragData.interval.length-1];d&&t.pageX>d.endX&&s.length&&s.css("margin-left",this.dragData.activeWidth+"px"),this.dragData.isLast=!0}}}},handleTabWrapDragLeave:function(t){!0===this.dragData.ing&&(t.pageY>=this.dragData.barStartY&&t.pageY<=this.dragData.barEndY-2||this.reduction())},handleTabWrapDrop:function(t,e){var i=this;if(!0===this.dragData.ing){l(this.$refs.tabTask).removeClass("transition"),t.preventDefault();var n=this.pids.indexOf(this.dragData.replaceId),s=this.pids.indexOf(this.dragData.id),r=0;if(n!==s||0===this.pids.length){if(this.dragData.isLast)r=this.pids.length-1<=-1?0:this.pids.length-1;else{var o=[];this.pids.forEach(function(t){t!==i.dragData.id&&o.push(t)}),r=o.indexOf(this.dragData.replaceId)}var a="";this.dragData.isCross?(c(this.process[this.dragData.rootTaskId].pids,function(t){return t===i.dragData.id}),a=this.dragData.id):a=this.pids.splice(s,1)[0],this.pids.splice(r,0,a),this.reduction(),this.dragData.$dom.removeAttr("dmwDrag").show(),this.$ddvMultiWindow.tabMoveMasterWindow({taskId:this.taskId,id:this.dragData.id}),this.handleTask(t,"click",this.dragData.id)}else this.reduction(),this.dragData.$dom.removeAttr("dmwDrag").show()}},pidsChange:function(){var t=this;this.$nextTick(function(){return t.tabTaskLiInit()})},tabTaskLiInit:function(){var n=this;this.pids&&Array.isArray(this.pids)&&this.pids.forEach(function(t){var e=l('[processid="'+t+'"]',n.$refs.tabTask),i=e[0];n.tabTaskLiLists[t]={dom:i,$:e,top:e.offset().top,left:e.offset().left,outerWidth:e.outerWidth(),outerHeight:e.outerHeight()}})}},watch:{pids:{deep:!0,handler:"pidsChange"}},destroyed:function(){}},u=function(){var i=this,t=i.$createElement,n=i._self._c||t;return n("div",{staticClass:"tabTask-menu tabTask"},[n("ul",{ref:"tabTaskWrap",staticClass:"tabTask-menu__ul clearfix",style:i.taskMenuStyle,on:{dragover:function(t){t.stopPropagation(),i.handleTabWrapDragOver(t,null)},dragleave:function(t){t.stopPropagation(),i.handleTabWrapDragLeave(t)},drop:function(t){t.stopPropagation(),i.handleTabWrapDrop(t,null)}}},[i._l(i.pids,function(e){return e&&i.process[e]?n("li",{key:e,ref:"tabTask",refInFor:!0,staticClass:"tabTask-menu__li",class:{"tabTask-menu__linow":e===i.activeId},attrs:{processid:e,draggable:"true"},on:{click:function(t){i.handleTask(t,"click",e)},contextmenu:function(t){i.handleTask(t,"contextMenu",e)},drop:function(t){t.stopPropagation(),i.handleTabWrapDrop(t,e)},dragstart:function(t){t.stopPropagation(),i.handleTabDragStart(t,e)},dragover:function(t){t.stopPropagation(),i.handleTabWrapDragOver(t,e)},dragend:function(t){t.stopPropagation(),i.handleTabDragEnd(t,e)}}},[n("div",{staticClass:"tabTask-menu__item"},[i._v(i._s(i.process[e].title))]),i._v(" "),n("div",{staticClass:"tabTask-menu__handle"},[n("div",{staticClass:"inline-block",on:{click:function(t){t.stopPropagation(),i.handleTask(t,"openMasterWindow",e)}}},[n("i",{staticClass:"dmw-icon icon-new-window f14"})]),i._v(" "),!1!==i.process[e].refreshable?n("div",{staticClass:"inline-block",on:{click:function(t){i.handleTask(t,"refresh",e)}}},[n("i",{staticClass:"dmw-icon icon-refresh f14"})]):i._e(),i._v(" "),!1!==i.process[e].closable?n("div",{staticClass:"inline-block",on:{click:function(t){i.handleTask(t,"remove",e)}}},[n("i",{staticClass:"dmw-icon icon-close f14"})]):i._e()])]):i._e()}),i._v(" "),n("li",{ref:"menuArrow",staticClass:"tabTask-menu__arrow",on:{mouseenter:function(t){i.isShowDropdown=!0},mouseleave:function(t){i.isShowDropdown=!1}}},[n("i",{staticClass:"dmw-icon icon-down-arrow tabTask-menu__pull f14"}),i._v(" "),n("transition",{attrs:{name:"fade"}},[n("ul",{directives:[{name:"show",rawName:"v-show",value:i.isShowDropdown,expression:"isShowDropdown"}],staticClass:"menu-dropdown"},[n("div",{staticClass:"menu-dropdown__arrow"}),i._v(" "),n("li",{staticClass:"menu-dropdown__item"},[n("div",{staticClass:"tabTask-menu__dropItem",on:{click:function(t){i.handleTask(t,"removeAll",i.task.id)}}},[n("div",{staticClass:"text-center"},[i._v("\u5173\u95ed\u5168\u90e8")])])]),i._v(" "),n("li",{staticClass:"menu-dropdown__item"},[n("div",{staticClass:"tabTask-menu__dropItem"},[n("div",{staticClass:"text-center tabTask-menu__manage"},[i._v("\u7ba1\u7406\u9ed8\u8ba4\u6807\u7b7e")])])]),i._v(" "),i.pids&&0<i.pids.length?n("li",{staticClass:"menu-dropdown__item-line"}):i._e(),i._v(" "),i._l(i.pids,function(e){return n("li",{key:e,staticClass:"menu-dropdown__item"},[n("div",{staticClass:"tabTask-menu__dropItem clearfix",on:{click:function(t){i.handleTask(t,"click",e)}}},[n("div",{staticClass:"tabTask-menu__title"},[i._v(i._s(i.process[e].title))]),i._v(" "),n("div",{staticClass:"tabTask-menu__util"},[!1!==i.process[e].closable?n("i",{staticClass:"dmw-icon icon-close f12",on:{click:function(t){i.handleTask(t,"remove",e)}}}):i._e(),i._v(" "),!1!==i.process[e].refreshable?n("i",{staticClass:"dmw-icon icon-refresh f12",on:{click:function(t){i.handleTask(t,"refresh",e)}}}):i._e()])])])})],2)])],1)],2)])};u._withStripped=!0;var p,f,v,w,g,k=(v=void 0,w=!(p={render:u,staticRenderFns:[]}),(g=("function"==typeof(f=h)?f.options:f)||{}).__file="/Users/sicmouse/Documents/GitHub/ddv-multi-window/src/components/taskComponents/horizontal-task.vue",g.render||(g.render=p.render,g.staticRenderFns=p.staticRenderFns,g._compiled=!0,w&&(g.functional=!0)),g._scopeId=v,g),y={name:"horizontal-task",props:{task:{type:Object},process:{type:Object,default:{}},handleTask:{type:Function},taskOptions:{type:Object}},computed:{taskId:function(){return this.task?this.task.id:null},activeId:function(){return this.task?this.task.activeId:null},pids:function(){return this.task?this.task.pids:[]},dragData:function(){return this.$ddvMultiWindow.dragData||{}},taskMenuStyle:function(){var e=this,i={};if(this.taskOptions.menuStyle&&"object"==typeof this.taskOptions.menuStyle){var n=Object.keys(this.taskOptions.menuStyle);n.forEach(function(t){(e.taskOptions.menuStyle[n]||0===e.taskOptions.menuStyle[n])&&(i[t]=e.taskOptions.menuStyle[n])})}return i}},data:function(){return{tabTaskLiLists:{},isLeave:!1,isShowDropdown:!1}},methods:{setInfo:function(t){var e=this,i=l(this.$refs.tabTaskWrap),n=this.pids.length;this.dragData.event=t,this.dragData.interval=[],this.dragData.$dom&&this.dragData.$dom.length?this.dragData.activeHeight=this.dragData.$dom.innerHeight()||this.dragData.activeHeight||0:this.dragData.activeHeight=this.dragData.activeHeight||0,this.dragData.marginTop=0,this.dragData.$dom.attr("dmwDrag","1");for(var s=0,r=0;r<n;r++){var o=l('[processid="'+e.pids[r]+'"]',e.$refs.tabTask),a=Number(o.css("margin-top").split("px")[0]),d=Number(o.css("margin-bottom").split("px")[0]),c=o.offset(),h=o.is('[dmwDrag="1"]'),u={};e.dragData.marginTop+=a,h?s=o.innerHeight()+a-d:(u.startY=c.top+a-s,u.endY=c.top+o.innerHeight()+a-d-s,u.pid=e.pids[r],e.dragData.interval.push(u))}this.dragData.marginTop=Math.round(this.dragData.marginTop/n),this.dragData.barStartX=i.offset().left,this.dragData.barEndX=this.dragData.barStartX+i.outerWidth()},reduction:function(){l('[active="active"]',this.$refs.tabTask).css("margin-top",this.dragData.marginTop+"px").removeAttr("active")},handleTabDragStart:function(t,e){var i=this.process[e],n=l(this.$refs.tabTask);this.dragData.$dom=n.closest(t.target),l(this.$refs.tabTask).addClass("transition"),this.setInfo(t),this.dragData.id=e,this.dragData.ing=!0,this.dragData.taskId=this.taskId,this.dragData.rootTaskId=this.taskId,this.dragData.isCross=!1,t.ddvCmsTaskWindowId=e,t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="linkMove",t.dataTransfer.setData("ddvCmsDrag",JSON.stringify({type:"tabTask",data:{windowId:e}})),t.dataTransfer.setData("text/plain",i.href||i.src)},handleTabDragEnd:function(t,e){var i=this;if(!0===this.dragData.ing)return this.dragData.ing=!1,l(this.$refs.tabTask).removeClass("transition"),this.activeEvent=null,this.dragData.id=null,this.reduction(),this.dragData.$dom.removeAttr("dmwDrag").fadeIn(),this.dragData.taskId!==this.taskId||t.pageX>=this.dragData.barStartX&&t.pageX<=this.dragData.barEndX-2?void 0:this.$ddvMultiWindow.tryRun(function(){return i.$ddvMultiWindow.openMasterWindow(e).catch(function(t){return"OPEN_WINDOW_FAIL"===t.name?i.$confirm("\u4f60\u662f\u5426\u8981\u5728\u65b0\u7a97\u53e3\u6253\u5f00","\u63d0\u793a",{confirmButtonText:"\u786e\u5b9a",cancelButtonText:"\u53d6\u6d88",type:"warning"}).then(function(){return i.$ddvMultiWindow.openMasterWindow(e)},function(t){}):Promise.reject(t)})})},handleTabWrapDragOver:function(t,e){var i=this;if(!0===this.dragData.ing){t.preventDefault();var n=l(this.$refs.tabTask);if(this.taskId!==this.dragData.taskId&&(l(this.$refs.tabTask).addClass("transition"),this.setInfo(this.dragData.event),this.dragData.isCross=this.dragData.rootTaskId!==this.taskId),this.dragData.taskId=this.taskId,t.pageX>=this.dragData.barStartX&&t.pageX<=this.dragData.barEndX-2){var s=!1;this.dragData.$dom.hide();for(var r=0;r<this.dragData.interval.length;r++){var o=i.dragData.interval[r];t.pageY>o.startY&&t.pageY<o.endY&&(s=!0,n.closest('[active="active"]').css("margin-top",i.dragData.marginTop+"px").removeAttr("active"),l('[processid="'+o.pid+'"]',i.$refs.tabTask).attr("active","active").css("margin-top",i.dragData.activeHeight+"px"),i.dragData.replaceId=o.pid,i.dragData.isLast=!1)}s||(n.closest('[active="active"]').length&&n.closest('[active="active"]').css("margin-top",this.dragData.marginTop+"px").removeAttr("active"),this.dragData.isLast=!0)}}},handleTabWrapDragLeave:function(t){!0===this.dragData.ing&&(t.pageX>=this.dragData.barStartX&&t.pageX<=this.dragData.barEndX-2||this.reduction())},handleTabWrapDrop:function(t,e){var i=this;if(!0===this.dragData.ing){l(this.$refs.tabTask).removeClass("transition"),t.preventDefault();var n=this.pids.indexOf(this.dragData.replaceId),s=this.pids.indexOf(this.dragData.id),r=0;if(n!==s||0===this.pids.length){if(this.dragData.isLast)r=this.pids.length-1<=-1?0:this.pids.length-1;else{var o=[];this.pids.forEach(function(t){t!==i.dragData.id&&o.push(t)}),r=o.indexOf(this.dragData.replaceId)}var a="";this.dragData.isCross?(c(this.process[this.dragData.rootTaskId].pids,function(t){return t===i.dragData.id}),a=this.dragData.id):a=this.pids.splice(s,1)[0],this.pids.splice(r,0,a),this.reduction(),this.dragData.$dom.removeAttr("dmwDrag").fadeIn(),this.$ddvMultiWindow.tabMoveMasterWindow({taskId:this.taskId,id:this.dragData.id}),this.handleTask(t,"click",this.dragData.id)}else this.reduction(),this.dragData.$dom.removeAttr("dmwDrag").fadeIn()}},pidsChange:function(){var t=this;this.$nextTick(function(){return t.tabTaskLiInit()})},tabTaskLiInit:function(){var n=this;this.pids&&Array.isArray(this.pids)&&this.pids.forEach(function(t){var e=l('[processid="'+t+'"]',n.$refs.tabTask),i=e[0];n.tabTaskLiLists[t]={dom:i,$:e,top:e.offset().top,left:e.offset().left,outerWidth:e.outerWidth(),outerHeight:e.outerHeight()}})}},watch:{pids:{deep:!0,handler:"pidsChange"}},destroyed:function(){}},b=function(){var i=this,t=i.$createElement,n=i._self._c||t;return n("ul",{ref:"tabTaskWrap",staticClass:"tabTask vertical-task clearfix",style:i.taskMenuStyle,on:{dragover:function(t){t.stopPropagation(),i.handleTabWrapDragOver(t,null)},dragleave:function(t){t.stopPropagation(),i.handleTabWrapDragLeave(t)},drop:function(t){t.stopPropagation(),i.handleTabWrapDrop(t,null)}}},i._l(i.pids,function(e){return e&&i.process[e]?n("li",{key:e,ref:"tabTask",refInFor:!0,staticClass:"vertical-task-menu__li",class:{"vertical-task-menu__atcive":e===i.activeId},attrs:{processid:e,draggable:"true"},on:{click:function(t){i.handleTask(t,"click",e)},contextmenu:function(t){i.handleTask(t,"contextMenu",e)},drop:function(t){t.stopPropagation(),i.handleTabWrapDrop(t,e)},dragstart:function(t){t.stopPropagation(),i.handleTabDragStart(t,e)},dragover:function(t){t.stopPropagation(),i.handleTabWrapDragOver(t,e)},dragend:function(t){t.stopPropagation(),i.handleTabDragEnd(t,e)}}},[n("div",{staticClass:"tabTask-menu__item"},[i._v("\n      "+i._s(i.process[e].title)+"\n    ")]),i._v(" "),n("div",{staticClass:"tabTask-menu__handle"},[n("div",{staticClass:"inline-block",on:{click:function(t){t.stopPropagation(),i.handleTask(t,"openMasterWindow",e)}}},[n("i",{staticClass:"dmw-icon icon-new-window f14"})]),i._v(" "),!1!==i.process[e].refreshable?n("div",{staticClass:"inline-block",on:{click:function(t){i.handleTask(t,"refresh",e)}}},[n("i",{staticClass:"dmw-icon icon-refresh f14"})]):i._e(),i._v(" "),!1!==i.process[e].closable?n("div",{staticClass:"inline-block",on:{click:function(t){i.handleTask(t,"remove",e)}}},[n("i",{staticClass:"dmw-icon icon-close f14"})]):i._e()])]):i._e()}))};b._withStripped=!0;var W,$,D,I,T,_=(D=void 0,I=!(W={render:b,staticRenderFns:[]}),(T=("function"==typeof($=y)?$.options:$)||{}).__file="/Users/sicmouse/Documents/GitHub/ddv-multi-window/src/components/taskComponents/vertical-task.vue",T.render||(T.render=W.render,T.staticRenderFns=W.staticRenderFns,T._compiled=!0,I&&(T.functional=!0)),T._scopeId=D,T),M={name:"ddv-multi-window-task-template",functional:!0,render:function(t,e){var i=e.props;return"vertical"===i.taskOptions.mode?t(_,{props:i}):t(k,{props:i})}},C={name:"ddv-multi-window-load",render:function(t){return t("section",[t("div",{},["\u52a0\u8f7d\u4e2d..."])])}};function P(t){if(Array.isArray(t))return t.map(P);if(t&&"object"==typeof t){var e={};for(var i in t)e[i]=P(t[i]);return e}return t}function O(t,e){return function e(i,n){Object.keys(n||{}).forEach(function(t){"object"==typeof i[t]?i[t]=e(i[t],n[t]):i[t]=d(i[t],n[t])});return i}(P(e),P(t))}var E=C;var R={data:function(){return{dragData:{id:null},process:{}}},computed:{ready:function(){return this.process.daemon.init},pids:function(){return Object.keys(this.process||{})||[]},taskIds:function(){var e=this;return this.pids.filter(function(t){return e.process[t]&&e.process[t].isTask})},viewIds:function(){var e=this;return this.pids.filter(function(t){return e.process[t]&&e.process[t].isHasView})},dragProcess:function(){return this.dragId&&this.process[this.dragId]||null}},created:function(){this.processPut({id:"daemon",mode:"daemon",isTask:!0,isHasView:!1,hasContentWindow:!0,contentWindow:this.$ddvMultiWindowGlobal.contentWindow}),this.$ddvMultiWindowGlobal.daemonInit(this),this.process.daemon.init=!0}};function A(e){return new Promise(function(t){return setTimeout(t,e)})}function S(t,e,i,n){if(this instanceof S)return S(t,e,i);var s=new Error(t||"Unknown Error");return s.name=e||i||s.name,s.errorId=i||s.name,n&&(s.stack=s.stack+"\n"+n),s}function j(t,e,i,n,s){if(!1===i)throw S(t,e,n,s);return Promise.reject(S(t,e,n,s))}function N(e,i,n,s){return(n=n||50)<s?(console.error(e,i),Promise.reject(new Error("\u67e5\u627e\u5931\u8d25"))):(s=(s||0)+1,e[i]?Promise.resolve(e[i]):A(60).then(function(t){return N(e,i,n,s)}))}var x=require("jquery"),L={methods:{regTask:function(t){var e=this.process[t];if(!e)throw new Error("\u6ca1\u6709\u627e\u5230\u4efb\u52a1\u680f\u7a97\u53e3");e.isTask&&Array.isArray(e.pids)||(this.$set(e,"isTask",!0),this.$set(e,"pids",[]),this.$set(e,"history",[]),this.$set(e,"activeId",null))},addTask:function(t){var e=t.taskId,i=t.id,n=this.process[e].pids;-1<n.indexOf(i)||n.push(i)},refreshTask:function(t){var i=this,n=t.taskId,s=t.id;(this.taskIds||[]).forEach(function(t){var e=i.process[t];e&&t!==n&&(e.pids=e.pids.filter(function(t){return t!==s}),e.history=e.history.filter(function(t){return t!==s}))})},windowAppendChild:function(t,e){var i,n,s=this,r=t.id,o=t.taskId,a=t.autoToTab;return 50<e?Promise.reject(new Error("\u67e5\u627e\u5931\u8d25")):(e=(e||0)+1,r&&(i=this.process[r])?i.removeing?Promise.resolve():i.$mainWrap&&i.$mainWrap[o]?(i.$mainWrap[o].append(i.$content),n=i.taskId,i.taskId=o,!1===a?Promise.resolve():this.tabToWindow(r).then(function(){return s.refreshTask({taskId:o,id:r}),s.tabToLastWindowByTaskId(n||"daemon")})):A(350).then(function(){return s.windowAppendChild({id:r,taskId:o,autoToTab:a},e)}):Promise.resolve())},viewMoveParentByPid:function(t){var e=this.process[t];e&&e.$parent&&e.$parent.length&&e.$content&&e.$content.length&&e.$parent.append(e.$content)},closeMasterWindow:function(t,e){var i=this,n=this.process[t||"daemon"];if(n&&(this.masterMoveParentByTaskId(t),!1!==e)){if(!0===e||e<=0){var s=this.process.daemon,r=n.activeId;if("master"!==n.mode)return;(n.history||[]).forEach(function(t){-1<s.history.indexOf(t)||s.history.push(t)});var o=(n.pids||[]).map(function(t){return i.addTask({taskId:"daemon",id:t}),i.windowAppendChild({taskId:"daemon",id:t,autoToTab:!1})});return n.hasContentWindow&&n.contentWindow&&!n.contentWindow.closed&&n.contentWindow.close(),Promise.all(o).then(function(){return n.pids.length=0,i.refreshTask({taskId:"daemon",id:r})})}clearTimeout(n.closeMasterTimer),n.closeMasterTimer=setTimeout(function(){i.closeMasterWindow(t,0)},e||5e3)}},closeAllMasterWindow:function(){var e=this.$ddvMultiWindowGlobal&&this.$ddvMultiWindowGlobal.map&&this.$ddvMultiWindowGlobal.map[this.daemonId]&&this.$ddvMultiWindowGlobal.map[this.daemonId].api;this.taskIds.forEach(function(t){Object.keys(e).forEach(function(t){e&&e[t]&&"function"==typeof e[t].onDaemonClose&&e[t].onDaemonClose()})})},masterMoveParentByTaskId:function(t){var e=t&&this.process[t];e&&(e.$mainParent&&e.$mainContent&&e.$mainParent.append(e.$mainContent),e.$taskParent&&e.$taskContent&&e.$taskParent.append(e.$taskContent))},masterViewInit:function(t,e,i){var n,s=this,r=this.process[e];return"view"===t?n="$mainContent":"task"===t&&(n="$taskContent"),r?(clearTimeout(r.closeMasterTimer),r[n]?r[n].length?i&&x(i).length?(i.append(r[n]),Promise.resolve()):Promise.reject(S("\u8fdb\u7a0b\u4e0d\u5b58\u5728")):Promise.reject(S("\u4efb\u52a1\u680f\u4e2d\u6ca1\u6709\u627e\u5230\u6302\u8f7d\u70b9")):N(r,n).then(function(){return s.masterViewInit(t,e,i)})):Promise.reject(S("\u8fdb\u7a0b\u4e0d\u5b58\u5728"))}}},H=0,B=0;function U(t){var e;return B!==V()&&(B=V(),H=0),e=B.toString()+(++H).toString(),t||(e=parseInt(e,10).toString(36)),e}function V(){return parseInt((new Date).getTime()/1e3)}var X,Y={methods:{tryRun:function(t){var i=this;return this._dmw$tryRun(t).catch(function(e){return i.errorHooks.length?Promise.all(i.errorHooks.map(function(t){return t&&t(e)})):Promise.reject(e)})},_dmw$tryRun:function(t){if("function"==typeof t)try{var e=t();return e&&e.then?e:Promise.resolve(e)}catch(t){return Promise.reject(t)}return Promise.resolve()},createPid:function(t){return(t.mode||"child")+U()},isHasId:function(t){return-1<this.pids.indexOf(t)},checkPid:function(t,e,i){var n=this,s=0!==e;return s&&e<i?j("Window does not exist","WINDOW_NOT_EXIST",s):(i=(i||0)+1,this.isHasId(t)?s?Promise.resolve():void 0:s?A(150).then(function(){return n.checkPid(t,e,i)}):j("Window does not exist","WINDOW_NOT_EXIST",s))},getPidByWindow:function(t,e,i){var n,s,r,o=this,a=0!==e;if(e=d(e,50),a&&e<i)return j("Find pid based on window","FIND_PID_FAIL_BY_CW",a);for(n in i=(i||0)+1,o.process)if((s=o.process[n]).hasContentWindow)if(!s.contentWindow||s.contentWindow.closed)r=!0;else if(s.contentWindow===t)return a?Promise.resolve(n):n;return a&&r?a?this.dmw$handleContentWindowLoad().then(function(){return A(150)}).then(function(){return o.getPidByWindow(t,e,i)}):j("Process contentWindow not has init or closed","PROCESS_CW_NOT_INIT_OR_CLOSED",a):j("window not found","WINDOW_NOT_FINT",a)},getWindowByPid:function(t,e,i){var n=this,s=0!==e;if(e=d(e,50),s&&e<i)return j("Find window  based on pid","FIND_CW_FAIL_BY_PID",s);if(i=(i||0)+1,!t)return j("must input pid","MUST_INPUT_PID",s);var r=this.process[t];return r?r.hasContentWindow?!r.contentWindow||r.contentWindow.closed?s?this.dmw$handleContentWindowLoad().then(function(){return A(150)}).then(function(){return n.getWindowByPid(t,e,i)}):j("Process contentWindow not has init or closed","PROCESS_CW_NOT_INIT_OR_CLOSED",s):s?Promise.resolve({contentWindow:r.contentWindow}):r.contentWindow:j("Process not has contentWindow","PROCESS_NOT_CW",s):j("Process data not found","PROCESS_NOT_FIND",s)},processPut:function(t){t.id=t.id||t.pid;this.$set(this.process,t.id,m(t,{mode:null,error:null,isTask:!1,isHasTask:!0,isHasView:!0,init:!1,refinit:!1}))},routerReady:function(){var i=this;return new Promise(function(t,e){return i.$router.onReady(t,e)})}}},F={props:{daemonId:{type:[Number,String],default:"daemon"},modeNotTasks:{type:Array,default:function(){return["daemon","master"]}},openMasterWindowSrc:{type:String,default:"/"},taskOptions:{type:Object,default:function(){return{}}},renderOptions:{type:Object,default:function(){return{root:{},daemon:{},views:{},mains:{},tasks:{},taskParent:{},taskBox:{},mainParent:{},mainBox:{style:{width:"100%",height:"100%"}},mainContent:{style:{width:"100%",height:"100%"}},viewParent:{},viewBox:{style:{width:"100%",height:"100%"}},viewLoad:{},viewError:{},viewComponent:{},viewIframe:{attrs:{frameborder:0,width:"100%",height:"100%",allowtransparency:!0}}}}}}};function G(t){if(t&&(X=t),t||"undefined"==typeof window||(X=window),!X)throw S("\u6ca1\u6709\u627e\u5230\u7a97\u53e3");return X}var q={methods:{tabToWindow:function(e){if(!this.isHasId(e))return Promise.reject(S("\u7a97\u53e3\u4e0d\u5b58\u5728"));var t=this.process[this.process[e].taskId||"daemon"];return t.activeId=e,c(t.history,function(t){return t===e}),t.history.unshift(e),Promise.resolve()},tabToLastWindowByTaskId:function(t){var e=this.process[t||"daemon"];return"daemon"===t||e.pids&&e.pids.length?e&&e.history[0]&&this.tabToWindow(e.history[0]):this.closeMasterWindow(t,0)||Promise.resolve()},tabMoveMasterWindow:function(t){var e=t.taskId,i=t.id;return this.regTask(e),this.addTask({taskId:e,id:i}),this.windowAppendChild({taskId:e,id:i})},openMasterWindow:function(t){try{var e=this.createPid({mode:"master"}),i=function(t,e,i){var n,s,r;if(!i){if("undefined"==typeof window||window.window!==window)throw S("window must input","WINDOW_MUST_INPUT");i=window}try{n=i.open(t,e.name||"",function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i+"="+t[i]);return e.join(",")}((r=i,(s=(s=e)||{}).width=s.width||640,s.height=s.height||480,s.left=s.left||r.screenX+(r.outerWidth-s.width)/2,s.top=s.top||r.screenY+(r.outerHeight-s.height)/2.5,s)))}catch(t){}if(n)return n;throw S("open window fail","OPEN_WINDOW_FAIL")}(this.openMasterWindowSrc,{name:e},this.daemonWindow||this.contentWindow);return this.processPut({id:e,mode:"master",isTask:!0,isHasView:!1,hasContentWindow:!0,contentWindow:i}),this.tabMoveMasterWindow({id:t,taskId:e})}catch(t){return Promise.reject(t)}}}};var z=/[!'()*]/g,J=function(t){return"%"+t.charCodeAt(0).toString(16)},K=/%2C/g,Q=function(t){return encodeURIComponent(t).replace(z,J).replace(K,",")};function Z(n){var t=n?Object.keys(n).map(function(e){var t=n[e];if(void 0===t)return"";if(null===t)return Q(e);if(Array.isArray(t)){var i=[];return t.forEach(function(t){void 0!==t&&(null===t?i.push(Q(e)):i.push(Q(e)+"="+Q(t)))}),i.join("&")}return Q(e)+"="+Q(t)}).filter(function(t){return 0<t.length}).join("&"):null;return t?"?"+t:""}var tt={methods:{open:function(e,t){var i=this,n={src:"/",title:"New window",closable:!0,refreshable:!0,removeing:!1,contentWindow:null,$content:null,$iframe:null,$parent:null,$mainWrap:{},hook:{beforeRefresh:[]},component:null,parentDdvMultiWindow:null,id:null},s=Object.create(null);if("string"==typeof e)s.src=e,s.options={src:e};else if("object"==typeof e){if(e.id&&-1<this.pids.indexOf(e.id)&&this.process[e.id])return this.tabToWindow(e.id).then(function(){if(!0===e.refresh)return i.refresh(e.id)}).then(function(){return i.process[e.id]});if(!e.src&&e.path){var r=e.path;e.query&&(r+=Z(e.query)),e.src=r}if(Object.keys(n).forEach(function(t){Object.hasOwnProperty.call(e,t)&&(s[t]=e[t]),s.options=e}),!s.src&&t.$process){var o=t.$process,a=o.route,d=a.path;e.query?d+=Z(e.query):d+=Z(a.query),s.src=d,!e.title&&o.title&&(s.title=o.title)}}if(s.src){var c=this.$router.getMatchedComponents(s.src);if(s.mode||(s.mode=c.length?"component":"iframe"),c.length){var h=this.$router.resolve(s.src),u=h.route,l=h.href;s.src=l,s.route=u}}else if("object"==typeof e){var p=this.$router.resolve(e),f=p.route,v=p.href;s.src=v,s.route=f}return s.taskId="object"==typeof e?e.taskId||t&&t.taskId:s.taskId||t&&t.taskId,s.mode=s.mode||"iframe",s.id||(s.id=this.createPid({mode:s.mode})),s.isHasTask=-1===this.modeNotTasks.indexOf(s.mode),s.hasContentWindow=void 0===s.hasContentWindow?-1<["iframe","daemon","master"].indexOf(s.mode):s.hasContentWindow,m(Object.assign(s,{daemonId:this.daemonId}),n),s.title=s.title||"\u65b0\u7a97\u53e3[id:"+s.id+"]",!s.isHasTask||this.process[s.taskId]&&this.process[s.taskId].isTask||(s.taskId="daemon"),s.isHasTask&&(this.regTask(s.taskId),this.addTask({taskId:s.taskId,id:s.id})),s.parentDdvMultiWindow=t||null,this.processPut(s),this.tabToWindow(s.id).then(function(){return i.process[s.id]})},remove:function(i){var n=this,t=this.process[i];return this.isHasId(i)?!1===t.closable?Promise.reject(new Error("this window cannot be closed")):(t.removeing=!0,this.viewMoveParentByPid(i),this.taskIds.forEach(function(t){var e=n.process[t];e&&(c(e.pids,function(t){return t===i}),c(e.history,function(t){return t===i}))}),this.$delete(this.process,i),this.tabToLastWindowByTaskId(t.taskId||"daemon")):Promise.reject(new Error("this window is not found"))},refresh:function(t){var e=this.process[t];if(!this.isHasId(t))return Promise.reject(new Error("this window is not found"));if(!1===e.refreshable)return Promise.reject(new Error("this window does not support refresh"));if("component"!==e.mode)return"iframe"===e.mode?this.getWindowByPid(t).then(function(t){t.contentWindow.location.reload(!0)}):Promise.reject(new Error("window does not support refresh"));if(e.component){if(Array.isArray(e.hook.beforeRefresh))for(var i=0;i<e.hook.beforeRefresh.length;i++){var n=e.hook.beforeRefresh[i];if(o(n))if(!1===n())return Promise.resolve()}e.component=null}}}},et=require("jquery");function it(e,i){return e.push(i),function(){var t=e.indexOf(i);-1<t&&e.splice(t,1)}}var nt={methods:{loadComponent:function(t){var e=this,i=this.process[t];return i&&i.isHasView?"component"!==i.mode?j("\u4e0d\u652f\u6301\u52a0\u8f7d"):(i.error=null,this.routerReady().then(function(){return e.$router.getMatchedComponents(i.src)}).then(function(t){if(!t.length){var e=new Error("404");return e.statusCode=404,Promise.reject(e)}return Promise.all(t.map(function(t){return t()}))}).then(function(t){i.component=Object.create(t[0]),i.component._ddvMultiWindow=new Pt(e,i.taskId,i),i.component.router=e.loadComponentRouter(i,i.component)}).catch(function(t){console.log("e",t),i.error=t})):j("\u4e0d\u652f\u6301\u663e\u793a")},loadComponentRouter:function(t,e){var i=Object.create(null);return Object.assign(i,st,{daemonApp:this,$parentRouter:this.$router,process:t,options:this.$router.options}),i}}},st={resolve:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this.$parentRouter.resolve.apply(this.$parentRouter,t)},init:function(t){t._route=this.process.route,this.$vm=t,this.history={},this.history.current=Object.assign({},this.process.route)},push:function(e,t,i){return this.$vm.$ddvMultiWindow?this.$vm.$ddvMultiWindow.open(e):this.daemonApp.$ddvMultiWindowGlobal.get(this.process.daemonId,this.process.taskId).then(function(t){return t.open(e)})},replace:function(t,e,i){this.history.current=this.resolve(t).route}},rt={name:"ddv-multi-window-daemon",mixins:[R,L,q,Y,F,tt,{methods:{dmw$iframeLoad:function(e,t){var i,n=this;return e&&(i=this.process[e])?"iframe"!==i.mode||i.removeing?Promise.resolve():Promise.resolve().then(function(){if(!i.$iframe)return N(n.$refs,"if_"+e).then(function(t){t=Array.isArray(t)?t[0]:t&&t[0]||t,i.$iframe=et(t)})}).then(function(){if((t||!i.contentWindow||i.contentWindow.closed)&&(i.contentWindow=i.$iframe[0]&&i.$iframe[0].contentWindow||null,!i.contentWindow||i.contentWindow.closed))return A(500).then(function(t){return n.dmw$iframeLoad(e,!0)})}):Promise.resolve()},dmw$mainWrapInit:function(t){var i,n=this;return t&&(i=this.process[t])?i.removeing||!i.isHasView?Promise.resolve():Promise.all((this.taskIds||[]).map(function(e){if(i.$mainWrap||n.$set(i,"$mainWrap",{}),!i.$mainWrap[e])return N(n.$refs,"mc_"+e+"_p_"+t).then(function(t){t=Array.isArray(t)?t[0]:t&&t[0]||t,i.$mainWrap[e]=et(t)})})):Promise.resolve()},dmw$viewInit:function(t){var e,i=this;return t&&(e=this.process[t])?e.removeing||!e.isHasView?Promise.resolve():e.refinit?this.dmw$mainWrapInit(t):Promise.resolve().then(function(){if(!e.$parent)return N(i.$refs,"vp_"+t).then(function(t){t=Array.isArray(t)?t[0]:t&&t[0]||t,e.$parent=et(t)})}).then(function(){if(!e.$content)return N(i.$refs,"vb_"+t).then(function(t){t=Array.isArray(t)?t[0]:t&&t[0]||t,e.$content=et(t)})}).then(function(){return i.dmw$mainWrapInit(t)}).then(function(){return e.refinit=!0,"iframe"===e.mode?(e.init=!0,i.dmw$iframeLoad(t)):"component"===e.mode?i.loadComponent(t).then(function(){e.init=!0}).catch(function(t){e.error=t}):void 0}).then(function(){e.init=!0}).then(function(){return i.windowAppendChild({id:t,taskId:e.taskId})}):Promise.resolve()},dmw$taskInit:function(t){var e,i=this;if(t&&(e=this.process[t])&&!e.refinit&&!e.removeing&&e.isTask)return Promise.resolve().then(function(){if(!e.$taskParent)return N(i.$refs,"tp_"+t).then(function(t){t=Array.isArray(t)?t[0]:t&&t[0]||t,e.$taskParent=et(t)})}).then(function(){if(!e.$taskContent)return N(i.$refs,"tb_"+t).then(function(t){t=Array.isArray(t)?t[0]:t&&t[0]||t,e.$taskContent=et(t)})}).then(function(){if(!e.$mainParent)return N(i.$refs,"mp_"+t).then(function(t){t=Array.isArray(t)?t[0]:t&&t[0]||t,e.$mainParent=et(t)})}).then(function(){if(!e.$mainContent)return N(i.$refs,"mb_"+t).then(function(t){t=Array.isArray(t)?t[0]:t&&t[0]||t,e.$mainContent=et(t)})}).then(function(){e.refinit=!0})},dmw$processInit:function(){var i=this,e=[];return this.pids.forEach(function(t){return e.push()}),Promise.all(this.pids.map(function(t){var e;return t&&(e=i.process[t])?e.isHasView?i.dmw$viewInit(t):e.isTask?i.dmw$taskInit(t):Promise.resolve():Promise.resolve()}))},dmw$ddvMultiWindowMapInit:function(){var e=this,i=this.$ddvMultiWindowGlobal.map[this.daemonId];return Promise.all(this.taskIds.map(function(t){i.api[t]||(i.api[t]=new Pt(i.app,t))}).concat(Object.keys(i.api||{}).map(function(t){-1<e.taskIds.indexOf(t)||e.$delete(i.api,t)})))},dmw$handleContentWindowLoad:function(){return Promise.all([this.dmw$handleMasterWindowLoad(),this.dmw$handleIframeLoad()])},dmw$handleMasterWindowLoad:function(){var i=this;return Promise.resolve(this.pids.map(function(t){if(!t||!i.process)return Promise.resolve();var e=i.process[t];return e&&e.hasContentWindow,Promise.resolve()}))},dmw$handleIframeLoad:function(t,e){var i=this;return this.tryRun(function(t){return A(300).then(function(t){return i.dmw$iframeLoad(e)})})},dmw$handlePidsChange:function(){var e=this;return this.tryRun(function(t){return Promise.all([e.dmw$processInit()])})},dmw$handleTaskIdsChange:function(){var e=this;return this.tryRun(function(t){return e.dmw$ddvMultiWindowMapInit()})},dmw$onbeforeunload:function(t){return t.returnValue="\u5173\u95ed\u4f1a\u5bfc\u81f4\u6240\u6709\u7a97\u53e3\u90fd\u5173\u95ed\uff0c\u60a8\u786e\u8ba4\u5173\u95ed","\u5173\u95ed\u4f1a\u5bfc\u81f4\u6240\u6709\u7a97\u53e3\u90fd\u5173\u95ed?"},dmw$handleCloseInit:function(){var t=this.$ddvMultiWindowGlobal.contentWindow;t.addEventListener("close",this.closeAllMasterWindow.bind(this)),t.addEventListener("unload",this.closeAllMasterWindow.bind(this)),t.addEventListener("beforeunload",this.dmw$onbeforeunload.bind(this))}},watch:{taskIds:{handler:"dmw$handleTaskIdsChange",deep:!0},pids:{handler:"dmw$handlePidsChange",deep:!0}},mounted:function(){this.dmw$handleCloseInit()}},{methods:{handleTask:function(t,e,i){var n=this;return this.$ddvMultiWindow.tryRun(function(){return n["handleTask$"+e](t,i)})},handleTask$click:function(t,e){return t.stopPropagation(),t.preventDefault(),this.$ddvMultiWindow.tabToWindow(e)},handleTask$refresh:function(t,e){return t.stopPropagation(),t.preventDefault(),this.$ddvMultiWindow.refresh(e)},handleTask$openMasterWindow:function(t,e){return t.stopPropagation(),t.preventDefault(),this.$ddvMultiWindow.openMasterWindow(e)},handleTask$remove:function(t,e){return t.stopPropagation(),t.preventDefault(),this.$ddvMultiWindow.remove(e)},handleTask$removeAll:function(t,e){var i=this;t.stopPropagation(),t.preventDefault();var n=[];return Array.isArray(this.process[e].pids)&&this.process[e].pids.forEach(function(t){return i.process[t]&&!1!==i.process[t].closable&&n.push(i.$ddvMultiWindow.remove(t))}),Promise.all(n)},handleTask$contextMenu:function(t,e){t.stopPropagation(),t.preventDefault(),console.log("\u53f3\u952e")}}},{methods:{onBeforeOpen:function(t){return it(this.beforeOpenHooks,t)},onOpened:function(t){return it(this.openedHooks,t)},onBeforeRemove:function(t){return it(this.beforeRemoveHooks,t)},onBeforeRefres:function(t){return it(this.beforeRefresHooks,t)},onRefreshed:function(t){return it(this.refreshedHooks,t)},onReady:function(i,n){var s=this;return this.readyCbs.push(i),n&&this.errorHooks.push(n),function(){var t=s.readyCbs.indexOf(i),e=s.errorHooks.indexOf(n);-1<t&&s.readyCbs.splice(t,1),-1<e&&s.errorHooks.splice(e,1)}},onError:function(t){return it(this.errorHooks,t)}},beforeCreate:function(){this.readyCbs=[],this.errorHooks=[],this.openedHooks=[],this.refreshedHooks=[],this.beforeOpenHooks=[],this.beforeRemoveHooks=[],this.beforeRefresHooks=[]}},nt],render:function(t){if(this.ready){var e=this.$slots.default?Array.prototype.concat(this.$slots.default):[];return e.push(t("div",O(this.renderOptions.daemon,{key:"daemon_wrap",directives:[{name:"show",rawName:"show",value:!1}]}),[function(t){return t("div",O(this.renderOptions.mains,{key:"mains",attrs:{"ddv-multi-window-type":"mains"}}),function(n){var s=this;return this.taskIds.map(function(e){var i=s.process[e];if(i&&i.isTask)return n("div",O(s.renderOptions.mainParent,{key:e,ref:"mp_"+e,attrs:{"task-id":e,"ddv-multi-window-type":"mainParent"}}),[n("div",O(s.renderOptions.mainBox,{key:"main",ref:"mb_"+e,attrs:{"task-id":e,"ddv-multi-window-type":"mainBox"}}),(s.viewIds||[]).map(function(t){return n("div",O(s.renderOptions.mainContent,{key:t,ref:"mc_"+e+"_p_"+t,attrs:{"task-id":e,"process-id":t,"ddv-multi-window-type":"mainContent"},directives:[{name:"show",rawName:"show",value:i&&t===i.activeId}]}))}))])})}.call(this,t))}.call(this,t),function(t){return t("div",O(this.renderOptions.views,{key:"views",attrs:{"ddv-multi-window-type":"views"}}),function(n){var s=this;return this.viewIds.map(function(e){var i=s.process[e];if(i&&i.isHasView){var t=[];return i.init?i.error?t.push(n(E,O(s.renderOptions.viewError,{key:"error",attrs:{"process-id":e,"ddv-multi-window-type":"errorBox"},props:{error:s.error}}))):"component"===i.mode?i.component?t.push(n(i.component,O(s.renderOptions.viewComponent,{props:{}}))):(i.init=!1,s.loadComponent(e).then(function(){i.init=!0}).catch(function(t){i.error=t})):"iframe"===i.mode&&t.push(n("iframe",O(s.renderOptions.viewIframe,{key:"iframe",ref:"if_"+e,on:{load:function(t){return s.dmw$handleIframeLoad(t,e)}},attrs:{src:i.src,"process-id":e,"ddv-multi-window-type":"iframe"}}))):t.push(n(C,O(s.renderOptions.viewLoad,{key:"load",attrs:{"process-id":e,"ddv-multi-window-type":"loadBox"}}))),n("div",O(s.renderOptions.viewParent,{key:e,ref:"vp_"+e,attrs:{"process-id":e,"ddv-multi-window-type":"viewParent"}}),[n("div",O(s.renderOptions.viewBox,{key:"view",ref:"vb_"+e,attrs:{"process-id":e,"ddv-multi-window-type":"viewBox"}}),t)])}})}.call(this,t))}.call(this,t),function(t){return t("div",O(this.renderOptions.tasks,{key:"tasks",attrs:{"ddv-multi-window-type":"tasks"}}),function(i){var n=this;return this.taskIds.map(function(t){var e=n.process[t];if(e&&e.isTask)return i("div",O(n.renderOptions.taskParent,{key:t,ref:"tp_"+t,attrs:{"process-id":t,"ddv-multi-window-type":"taskParent"}}),[i("div",O(n.renderOptions.taskBox,{key:"task",ref:"tb_"+t,attrs:{"process-id":t,"ddv-multi-window-type":"taskBox"}}),function(t,e){var i={task:e,process:this.process,handleTask:this.handleTask,taskOptions:this.taskOptions},n=[];return this.$scopedSlots&&this.$scopedSlots.task?n.push(this.$scopedSlots.task(i)):n.push(t(M,{key:"task",attrs:{"ddv-multi-window-type":"taskContent"},props:i})),n}.call(n,i,e))])})}.call(this,t))}.call(this,t)])),t("div",O(this.renderOptions.root,{key:"root",attrs:{id:"dmw_daemon_"+this.daemonId,"ddv-multi-window-type":"root"}}),e)}}},ot={name:"ddv-multi-window-button",props:{to:{type:[String,Object]},type:{type:String,default:"open"},tag:{type:String,default:"button"},daemonId:{type:[Number,String],default:"daemon"},taskId:{type:[Number,String],default:""},event:{type:[String,Array],default:"click"},title:{type:String}},data:function(){return{ddvMultiWindowReady:!1,error:null}},render:function(t){var e=this,i={click:at};return Array.isArray(this.event)?this.event.forEach(function(t){i[t]=e.handler.bind(e)}):i[this.event]=this.handler.bind(this),t(this.tag,{on:i},this.$slots.default)},methods:{masterInit:function(){var e=this;this.$ddvMultiWindowGlobal.masterInit(this).then(function(){e.ddvMultiWindowReady=!0},function(t){console.error(t),e.error=t})},handler:function(t){var e=this;if(at(t)){var i=t.currentTarget.getAttribute("target")||this.taskId,n=O("string"==typeof this.to?{src:this.to}:P(this.to),{taskId:i});if(this.title&&(n.title=this.title),!this.ddvMultiWindowReady)return this.$ddvMultiWindowGlobal.masterInit(this).then(function(){e.comply(n)});this.comply(n)}},comply:function(t){var e=this;this.$ddvMultiWindow.tryRun(function(){switch(e.type){case"open":return e.$ddvMultiWindow.open(t);case"close":case"remove":return e.$ddvMultiWindow.remove(e.$router.process.id);default:return Promise.reject(new Error("this operation is not supported yet"))}})}},created:function(){this.$isServer||this.masterInit()}};function at(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey||t.defaultPrevented))return t.preventDefault&&t.preventDefault(),!0}var dt={name:"ddv-multi-window-error",props:{view:{type:String,default:"view"},error:{}},render:function(t){return t("section",[t("div",{},[this.message])])},computed:{message:function(){return this.error.message||"\u51fa\u9519\u4e86"}}},ct=require("jquery"),ht=ut();function ut(t,e){return{name:t||"ddv-multi-window-master",props:{daemonId:{type:[Number,String],default:"daemon"},view:{type:String,default:e||"view"},autoColse:{type:Boolean,default:!0}},data:function(){return{ddvMultiWindowReady:!1,refReady:!1,error:null,init:!1,wrap:null,$wrap:null}},render:function(t){var e=[];return this.error?e.push(t(dt,{key:"error",attrs:{"ddv-multi-window-type":"errorBox"},props:{view:this.view,error:this.error}})):this.init||e.push(t(C,{key:"load"})),t("div",{key:"master",ref:"m",attrs:{id:"dmw_master_"+this.view+this.daemonId,"ddv-multi-window-type":"master"+this.view}},e)},methods:{masterInit:function(){var e=this;this.$ddvMultiWindowGlobal.masterInit(this).then(function(){e.$ddvMultiWindow.onDaemonClose=e.onDaemonClose.bind(e),e.ddvMultiWindowReady=!0},function(t){console.error(t),e.error=t})},refReadyInit:function(){var e=this;return Promise.resolve().then(function(){if(!e.wrap)return N(e.$refs,"m").then(function(t){t=Array.isArray(t)?t[0]:t&&t[0]||t,e.wrap=t,e.$wrap=ct(e.wrap)})}).then(function(){e.refReady=!0})},closeWindow:function(){try{this.contentWindow.close()}catch(t){try{window.close()}catch(t){}}},closeMasterWindow:function(){try{this.$ddvMultiWindow.closeMasterWindow(this.taskId,5e3)}catch(t){this.closeWindow()}},masterViewInit:function(){var t=this;if(this.masterReady){var e=this.contentWindow;e.addEventListener("close",this.closeMasterWindow.bind(this)),e.addEventListener("unload",this.closeMasterWindow.bind(this)),this.$ddvMultiWindow.masterViewInit(this.view,this.taskId,this.$wrap).then(function(){t.init=!0})}},onDaemonClose:function(){var t=this;this.$ddvMultiWindow.masterMoveParentByTaskId(this.taskId),this.error=new Error("\u4e3b\u7a97\u53e3\u88ab\u5173\u95ed"),this.autoColse&&setTimeout(function(){t.closeWindow()},1500)}},computed:{taskId:function(){return this.ddvMultiWindowReady?this.$ddvMultiWindow.taskId:null},contentWindow:function(){return this.$ddvMultiWindowGlobal.contentWindow},masterReady:function(){return this.refReady&&this.ddvMultiWindowReady}},watch:{masterReady:{handler:"masterViewInit"}},created:function(){this.$isServer||this.masterInit()},mounted:function(){this.$isServer||this.refReadyInit()}}}var lt={name:"dmw-button",functional:!0,render:function(t,e){var i=e.data,n=e.children,s=e.props;return i.props=s,t(ot,i,n)}},pt=ut("ddv-multi-window-task","task"),ft=ut("ddv-multi-window-view","view");function vt(t,e){return(t=t||this)&&t[e]?t[e]:t&&t.$parent?vt(t.$parent,e):null}var mt=yt.prototype=Object.create(null),wt=Object.create(null),gt=new yt,kt=Object.hasOwnProperty;function yt(){}Object.assign(gt,{get:function(t,e,i,n){var s=0!==i;if(!this.installed)return j("not installed. Make sure to call `Vue.use(DdvMultiWindow)`before creating root instance.","MUST_VUE_USE_DDV_MULTI_WINDOW",s);var r=this.map[t];if(!(r&&r.app&&r.api))return j("daemonId does not exist","DAEMONID_NOT_EXIST",s);if(e&&r.api[e])return s?Promise.resolve(r.api[e]):r.api[e];if("daemon"===e)return r.api.daemon=new bt(r.app,e),s?Promise.resolve(r.api.daemon):r.api.daemon;return e=r.api.daemon.getPidByWindow(this.contentWindow,i,n),s?e.then(function(t){return t&&!r.api[t]&&(r.api[t]=new bt(r.app,t)),Promise.resolve(r.api[t])}):(e&&!r.api[e]&&(r.api[e]=new bt(r.app,e)),r.api[e])},isDaemon:!0,version:"0.1.10",Ready:e,install:function(t,e){if((this.installing||this.installed)&&this.$Vue===t)return;if(this.installing=!0,this.$Vue=t,this.options=e,function(t){var e=t.config.optionMergeStrategies;e.beforeDdvMultiWindowOpen=e.ddvMultiWindowOpened=e.beforeDdvMultiWindowRemove=e.ddvMultiWindowRemoved=e.beforeDdvMultiWindowRefresh=e.ddvMultiWindowRefreshed=e.created}.call(this,t),function(t){t.component(M.name,M),t.component(rt.name,rt),t.component(ot.name,ot),t.component(ht.name,ht),t.component(lt.name,lt),t.component(pt.name,pt),t.component(ft.name,ft)}.call(this,t),function(t){var e=this;kt.call(t.prototype,"$ddvMultiWindow")||Object.defineProperty(t.prototype,"$ddvMultiWindow",{get:function(){if(this._ddvMultiWindow||(this._ddvMultiWindow=vt(this,"_ddvMultiWindow")),this._ddvMultiWindow)return this._ddvMultiWindow;throw S("Not initialized")}}),kt.call(t.prototype,"$ddvMultiWindowGlobal")||Object.defineProperty(t.prototype,"$ddvMultiWindowGlobal",{get:function(){return e}})}.call(this,t),function(t){t.mixin({beforeCreate:function(){this._ddvMultiWindow||(this._ddvMultiWindow=this.$options._ddvMultiWindow||vt(this.$parent,"_ddvMultiWindow")),this._ddvMultiWindow&&this._ddvMultiWindow.register(this)},destroyed:function(){this._ddvMultiWindow&&this._ddvMultiWindow.unregister&&(this._ddvMultiWindow.unregister(this),delete this._ddvMultiWindow)}})}.call(this,t),t.prototype.$isServer)return this.installing=!1,void(this.installed=!0);(function(){this.options=m(this.options||{},{namespace:"__DDV_MULTI_WINDOW__"})}).call(this),function(){this.options.window||(this.options.window=void 0===typeof window?this.options.window:window);this.contentWindow=G(this.options.window),this.daemonWindow=function t(e){var i,n;e=G(e);try{i=e.location.host}catch(t){}if(!n||n===e)try{if(e.parent&&e.parent.location&&i===e.parent.location.host)try{e.parent.$ddvUtil&&e.parent.$ddvUtil.$daemonWindow&&e.parent.$ddvUtil.$daemonWindow.location&&i===e.parent.$ddvUtil.$daemonWindow.location.host&&(n=e.parent.$ddvUtil.$daemonWindow)}catch(t){}}catch(t){}if(!n||n===e)try{if(e.top&&e.top.location&&i===e.top.location.host){try{e.top.$ddvUtil&&e.top.$ddvUtil.$daemonWindow&&e.top.$ddvUtil.$daemonWindow.location&&i===e.top.$ddvUtil.$daemonWindow.location.host&&(n=e.top.$ddvUtil.$daemonWindow)}catch(t){}if(!n){n=e.top;try{e.top.opener&&e.top.opener.location&&i===e.top.opener.location.host&&(n=e.top.opener)}catch(t){}}}}catch(t){}if(!n||n===e)try{if(e.parent&&e.parent.location&&i===e.parent.location.host){n=e.parent;try{e.parent.opener&&e.parent.opener.location&&i===e.parent.opener.location.host&&(n=e.parent.opener)}catch(t){}}}catch(t){}if(!n||n===e)try{if(e.opener&&e.opener.location&&i===e.opener.location.host){try{e.opener.$ddvUtil&&e.opener.$ddvUtil.$daemonWindow&&e.opener.$ddvUtil.$daemonWindow.location&&i===e.opener.$ddvUtil.$daemonWindow.location.host&&(n=e.opener.$ddvUtil.$daemonWindow)}catch(t){}if(!n){n=e.opener;try{e.opener.opener&&e.opener.opener.location&&i===e.opener.opener.location.host&&(n=e.opener.opener)}catch(t){}}}}catch(t){}return n&&n!==e&&(n=t(n)),n||(n=e),n}(this.contentWindow),this.isDaemon=!this.contentWindow||this.contentWindow===this.daemonWindow;try{this.contentWindow&&(this.contentWindow.$ddvUtil||(this.contentWindow.$ddvUtil={}),this.contentWindow.$ddvUtil.$daemonWindow=this.daemonWindow)}catch(t){}}.call(this),function(t){t=t||this.options.namespace,this.contentWindow[t]||(this.contentWindow[t]=this)}.call(this),function(){if(this.map)return;this.contentWindow===this.daemonWindow?this.map=Object.create(null):this.daemonWindow&&this.daemonWindow[this.namespace]&&(this.map=this.daemonWindow[this.namespace].map||this.map);if(!this.map)throw S("Initialization failed, check if the 'options.namespace' is consistent with the daemon window")}.call(this),this.installing=!1,this.installed=!0},installed:!1,daemonInit:function(t){if(this.$isServer)return;var e=t.daemonId;if(!e)return j("not installed. Make sure to call `daemonInit(app)`before creating root instance.","DAEMON_NOT_INIT",!1);this.map[e]||(this.map[e]={app:t,api:{}});return t._ddvMultiWindow=this.get(e,"daemon",0)},masterInit:function(i){var e=this;if(this.$isServer)return;if(!this.installed)throw S("not installed. Make sure to call `Vue.use(DdvMultiWindow)`before creating root instance.");if(!i)throw S("\u5fc5\u987b\u4f20\u5165app\u5b9e\u4f8b");var t=i.daemonId;return this.get(t).then(function(t){try{e.contentWindow&&t&&(e.contentWindow.name=t.taskId)}catch(t){}return i._ddvMultiWindow=t},function(t){var e;return"DAEMONID_NOT_EXIST"===t.name&&(e=vt(i,"_ddvMultiWindow"))?e:Promise.reject(t)})}}),Object.assign(wt,{$isServer:function(){return this.$Vue?this.$Vue.prototype.$isServer:null},$Vue:[function(){return this._Vue?this._Vue:null},function(t){return this._Vue=t}],namespace:[function(){return this.options&&this.options.namespace},function(t){return this.options=this.options||Object.create(null),this.options.namespace=t}]}),Object.keys(wt).forEach(function(t){if(!kt.call(yt.prototype,t)){var e=wt[t];if(o(e))Object.defineProperty(mt,t,{get:e});else if(Array.isArray(e)){var i={};r(e[0])&&o(e[0])&&(i.get=e[0]),r(e[1])&&o(e[1])&&(i.set=e[1]),Object.defineProperty(mt,t,i)}}});var bt,Wt=gt.install,$t=Pt.prototype=Object.create(null),Dt=Object.hasOwnProperty,It=Object.create(null),Tt="proxyDaemonApp";function _t(t){return this.daemonApp.remove(t||this.id)}function Mt(){var t=this;return this.back().then(function(){return t.remove()})}function Ct(){var t=this;return this.backRefresh().then(function(){return t.remove()})}function Pt(){if(this instanceof Pt)return this.constructor.apply(this,arguments);throw Error("Must `new DdvMultiWindow()`")}function Ot(t){return this instanceof Ot?function(t){if(this.eventName=t.eventName||"ddvTabSysEventMessage",this.postMessageType=t.postMessageType||this.eventName+"#",this.targetOrigin=t.targetOrigin||"*",this.selfWindow=t.selfWindow||this.selfWindow,this.postEmitCallCbs={},!this.selfWindow){if("object"!=typeof window||window!==window.window)throw S("options.selfWindow must input","OPTIONS_SELFWINDOW_MUST_INPUT");this.selfWindow=window}this.selfWindow=t.selfWindow||("object"==typeof window&&window===window.window?window:this.selfWindow),this.setGetContentWindow(t.getContentWindow),o(t.onCatch)&&(this.onCatch=t.onCatch);this.onReceives={},function(t){t.addEventListener?(t.addEventListener("message",St.bind(this),!1),t.addEventListener(this.eventName,jt.bind(this),!1)):t.attachEvent&&(t.attachEvent("onmessage",St.bind(this)),t.attachEvent("on"+this.eventName,jt.bind(this)));try{"object"!=typeof t.onDdvMultiWindowEMCall&&(t.onDdvMultiWindowEMCall=Object.create(null)),t.onDdvMultiWindowEMCall[this.eventName]=function(t){try{this.receive(t)}catch(t){return!1}return!0}.bind(this)}catch(t){}return Promise.resolve()}.call(this,this.selfWindow),function(){this.on("postEmitCallCb",function(t){var e,i=t.data.id,n=t.data.res,s=t.data.error;s&&(s.message||s.stack)?(s.stack&&(e="@postEmitCallCb ------postEmitCallCb------\n"+s.stack),Et.call(this,i,void 0,S(s.message,s.name,s.errorId,e))):Et.call(this,i,n)}.bind(this))}.call(this)}.call(this,t):new Ot(t)}function Et(t,e,i){this.postEmitCallCbs[t]?(i?this.postEmitCallCbs[t][1](i):this.postEmitCallCbs[t][0](e),delete this.postEmitCallCbs[t]):console.debug("\u4e0d\u5b58\u5728")}function Rt(t,e,i,n,s,r){var o,a,d,c,h,u,l;if("object"!=typeof i)return l=arguments,a=Array.prototype.slice.call(l),t=e=o=n=s=r=void 0,this.getContentWindow(i).then(function(t){return a[2]=t,t=a,a=void 0,Rt.apply(this,t)}.bind(this));o=i,s=s||U();var p=JSON.stringify({id:s,type:t,data:e,isCb:r||!1});try{c=o.postMessage||void 0,u=o.targetOrigin||void 0,(h=o.contentWindow||o)&&"function"==typeof h.postMessage&&o.isPostMessage&&(c=h.postMessage.bind(h)),d="function"==typeof c}catch(t){h=o}if(u||(u=this.targetOrigin||"*"),d)try{return c(this.postMessageType+p,u,n),Promise.resolve(s)}catch(t){}if(function(t,e){var i;try{if("object"==typeof t.onDdvMultiWindowEMCall&&"function"==typeof t.onDdvMultiWindowEMCall[this.eventName])return i=this.getMessageEvent(this.eventName,{data:e}),t.onDdvMultiWindowEMCall[this.eventName](i)&&!0}catch(t){}}.call(this,h,p))return Promise.resolve(s);if(function(t,e){var i;try{i=this.getMessageEvent(this.eventName,{data:e});try{if("function"==typeof t.dispatchEvent)return t.dispatchEvent(i),!0}catch(t){}try{if("function"==typeof t.fireEvent)return t.fireEvent("on"+this.eventName,i),!0}catch(t){}}catch(t){}return!1}.call(this,h,p))return Promise.resolve(s);try{if(h&&h.postMessage&&h.postMessage!==c)return h.postMessage(this.postMessageType+p,u,n),Promise.resolve(s)}catch(t){return Promise.reject(t)}return Promise.reject(S("postMessage fail","POST_MESSAGE_FAIL"))}function At(n){return new Promise(function(t,e){var i=n(this.event);o(i.then)?(this.isCb=!0,i.then(t,e)):i?(this.isCb=!0,t(i)):t(),t=e=void 0}.bind(this)).then(function(t){return this.isCb&&this.event&&this.event.id&&this.postEmit("postEmitCallCb",{id:this.event.id,res:t},{contentWindow:this.event.source})}.bind(this),function(t){return this.isCb&&this.event&&this.event.id&&this.postEmit("postEmitCallCb",{id:this.event.id,error:{name:t.name||void 0,stack:t.stack||void 0,message:t.message||void 0,errorId:t.errorId||void 0}},{contentWindow:this.event.source})}.bind(this))}function St(t){var e=t.data||void 0;if("string"==typeof e&&e.substr(0,this.postMessageType.length)===this.postMessageType)return this.receive(t,e.substr(this.postMessageType.length))}function jt(t){return this.receive(t)}bt=Pt,Object.assign($t,{constructor:function(t,e,i){n(gt.installed,"not installed. Make sure to call `Vue.use(DdvMultiWindow)` before creating root instance."),n(s,"\u5fc5\u987b\u6709\u4e00\u4e2awindow"),this._vueModels=[],this._daemonApp=t,this._initTaskId=e,this._process=i||null},register:function(t){Array.isArray(this._vueModels)&&this._vueModels.push(t),this.process&&t&&t.$options.beforeDdvMultiWindowRefresh&&t.$options.beforeDdvMultiWindowRefresh.length&&this.process.hook.beforeRefresh.push.apply(this.process.hook.beforeRefresh,t.$options.beforeDdvMultiWindowRefresh)},unregister:function(e){this.process&&this.process.hook&&e&&e.$options&&e.$options.beforeDdvMultiWindowRefresh&&(this.process.hook.beforeRefresh=this.process.hook.beforeRefresh.filter(function(t){return e.$options.beforeDdvMultiWindowRefresh.indexOf(t)<0}));Array.isArray(this._vueModels)&&(this._vueModels=this._vueModels.filter(function(t){return e!==t}),this._vueModels.length||this.destroy())},open:function(t){return this.daemonApp.open(t,this)},remove:_t,refresh:function(t){return this.daemonApp.refresh(t||this.id)},close:_t,destroy:function(){delete this._vueModels,delete this._daemonApp,delete this._initTaskId,delete this._process},back:function(){return this.parent&&this.tabToWindow(this.parent.id)},backRefresh:function(){var t=this;return this.back().then(function(){return t.refresh(t.parent.id)})},removeBack:Mt,removeBackRefresh:Ct,closeBack:Mt,closeBackRefresh:Ct}),Object.assign(It,{tryRun:Tt,onError:Tt,dragData:Tt,dragProcess:Tt,masterViewInit:Tt,tabToWindow:Tt,getPidByWindow:Tt,getWindowByPid:Tt,openMasterWindow:Tt,windowAppendChild:Tt,tabMoveMasterWindow:Tt,closeMasterWindow:Tt,masterMoveParentByTaskId:Tt,systemProcess:function(){return this.daemonApp.process},process:function(){return this._process?this._process:null},id:function(){return this.process?this.process.id:null},parent:function(){return this.process&&this.process.parentDdvMultiWindow?this.process.parentDdvMultiWindow:null},taskId:function(){return this.process?this.process.taskId:this._initTaskId?this._initTaskId:null},daemonId:Tt,daemonApp:function(){return this._daemonApp?this._daemonApp:null}}),Object.keys(It).forEach(function(e){if(!Dt.call($t,e)){var t=It[e];if(t===Tt)Object.defineProperty($t,e,{get:function(){return n(this.daemonApp,"\u591a\u7a97\u53e3\u6ca1\u6709\u521d\u59cb\u5316"),this.daemonApp[e]},set:function(t){return n(this.daemonApp,"\u591a\u7a97\u53e3\u6ca1\u6709\u521d\u59cb\u5316"),this.daemonApp[e]=t}});else if(o(t))Object.defineProperty($t,e,{get:t});else if(Array.isArray(t)){var i={};r(t[0])&&o(t[0])&&(i.get=t[0]),r(t[1])&&o(t[1])&&(i.set=t[1]),Object.defineProperty($t,e,i)}}}),Object.assign(Ot.prototype,{eventName:"ddvTabSysEventMessage",targetOrigin:"*"},{on:function(t,e){Array.isArray(this.onReceives[t])||(this.onReceives[t]=[]);this.onReceives[t].push(e)},emit:function(t){var e;if(!t.type)return(e=S("Message type error","MESSAGE_TYPE_ERROR")).isDecodeError=!0,Promise.reject(e);for(var i=this.onReceives[t.type]||[],n=0;n<i.length;n++)At.call({isCb:!1,event:t,postEmit:Rt.bind(this)},i[n]);t=void 0},remove:function(t,e){var i=this;if("function"==typeof t)for(var n in e=t,i.onReceives)i.onReceives.hasOwnProperty(n)&&i.remove(n,e);else if("string"==typeof t)if("function"==typeof e)for(var s=0;s<this.onReceives[t].length;s++)Array.isArray(i.onReceives[t])&&i.onReceives[t][s]===e&&(i.onReceives[t].splice(s,1),s--);else delete this.onReceives[t]},destroy:function(){},onCatch:function(t){return Promise.reject(t)},receive:function(i,t){return this.decodeMessage(t||i.data||void 0).then(function(t){var e=this.getMessageEvent(t.type,Object.assign(Object.create(null),{source:i.source,origin:i.origin},t));return this.emit(e)}.bind(this),function(t){return t.isDecodeError=!0,this.onCatch(t)}.bind(this))},postEmit:Rt,postEmitCall:function(t,s,r,o){return new Promise(function(e,i){var n=U();this.postEmitCallCbs[n]=[e,i],this.postEmit(t,s,r,o,n,!0).then(function(){n=e=i=void 0},function(t){Et.call(this,n,void 0,t),n=e=i=t=void 0}.bind(this))}.bind(this))},decodeMessage:function(t){var e;if("string"!=typeof t)return Promise.reject(S("Input must be a string","INPUT_MUST_STRING"));try{e=JSON.parse(t)}catch(t){return Promise.reject(S("window not found","WINDOW_NOT_FINT"))}return Promise.resolve(e)},getMessageEvent:function(t,e){var i;(e="object"==typeof e?e:Object.create(null)).source=e.source||this.selfWindow,e.origin=e.origin||this.selfWindow.origin||this.selfWindow.location&&this.selfWindow.location.origin;try{i="function"==typeof MessageEvent?new MessageEvent(t,e):new Event(t,e)}catch(t){i=e}return"source origin ports data id isCb".split(" ").forEach(function(t){try{e[t]&&i[t]!==e[t]&&(i[t]=e[t])}catch(t){}}),i},setGetContentWindow:function(t){o(t)?this.getContentWindow=t:this.getContentWindow=function(){return Promise.resolve({contentWindow:window})}}}),s&&window.Vue&&window.Vue.use(Pt),t.Ready=e,t.install=Wt,t.default=gt,t.EventMessageWindow=Ot,Object.defineProperty(t,"__esModule",{value:!0})});